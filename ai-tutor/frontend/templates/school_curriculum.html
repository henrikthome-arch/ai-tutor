{% extends "base.html" %}

{% block title %}{{ school.name }} Curriculum - AI Tutor Admin{% endblock %}

{% block content %}
<div class="breadcrumb">
    <a href="{{ url_for('admin_dashboard') }}">üìä Dashboard</a> / 
    <a href="{{ url_for('admin_schools') }}">üè´ Schools</a> / 
    <a href="{{ url_for('edit_school', school_id=school.school_id) }}">{{ school.name }}</a> / 
    <span>üìö Curriculum</span>
</div>

<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <h1 style="color: #2c3e50;">{{ school.name }} Curriculum</h1>
    <div>
        <a href="{{ url_for('add_curriculum') }}" class="btn btn-success">
            ‚ûï Add Curriculum
        </a>
        <a href="{{ url_for('edit_school', school_id=school.school_id) }}" class="btn" style="background: #3498db;">
            ‚úèÔ∏è Edit School
        </a>
    </div>
</div>

<div class="card" style="margin-bottom: 2rem;">
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
        <div>
            <h3 style="color: #2c3e50; margin-top: 0;">School Information</h3>
            <table class="info-table">
                <tr>
                    <th>Name:</th>
                    <td>{{ school.name }}</td>
                </tr>
                <tr>
                    <th>Location:</th>
                    <td>{{ school.location }}</td>
                </tr>
                <tr>
                    <th>Curriculum Type:</th>
                    <td>{{ school.curriculum_type }}</td>
                </tr>
                <tr>
                    <th>Background:</th>
                    <td>{{ school.background }}</td>
                </tr>
            </table>
        </div>
        
        <div>
            <h3 style="color: #2c3e50; margin-top: 0;">Curriculum Summary</h3>
            {% if curriculums %}
            <p>{{ curriculums|length }} curriculum entries available for this school.</p>
            <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 1rem;">
                {% for grade in range(3, 13) %}
                {% set grade_curriculums = curriculums|selectattr('grade', 'eq', grade)|list %}
                {% if grade_curriculums %}
                <span class="badge" style="background: #3498db;">Grade {{ grade }}: {{ grade_curriculums|length }}</span>
                {% endif %}
                {% endfor %}
            </div>
            {% else %}
            <p>No curriculum entries available for this school.</p>
            <a href="{{ url_for('add_curriculum') }}" class="btn btn-success" style="margin-top: 1rem;">
                ‚ûï Add First Curriculum
            </a>
            {% endif %}
        </div>
    </div>
</div>

<div class="card">
    <h2 style="color: #2c3e50; margin-top: 0;">Curriculum Entries</h2>
    
    {% if curriculums %}
    <table class="data-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Grade</th>
                <th>Subject</th>
                <th>Student Type</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for curriculum in curriculums %}
            <tr>
                <td>{{ curriculum.id }}</td>
                <td>Grade {{ curriculum.grade }}</td>
                <td>{{ curriculum.subject }}</td>
                <td>{{ curriculum.student_type }}</td>
                <td>
                    <div class="action-buttons">
                        <a href="{{ url_for('edit_curriculum', curriculum_id=curriculum.id) }}" class="btn-small" title="Edit">
                            ‚úèÔ∏è
                        </a>
                        <form method="POST" action="{{ url_for('delete_curriculum', curriculum_id=curriculum.id) }}" 
                              onsubmit="return confirm('Are you sure you want to delete this curriculum?');" 
                              style="display: inline;">
                            <button type="submit" class="btn-small btn-danger" title="Delete">
                                üóëÔ∏è
                            </button>
                        </form>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-state">
        <p>No curriculum entries found for this school.</p>
        <a href="{{ url_for('add_curriculum') }}" class="btn btn-success">
            ‚ûï Add Curriculum
        </a>
    </div>
    {% endif %}
</div>

<div class="card" style="margin-top: 2rem;">
    <h2 style="color: #2c3e50; margin-top: 0;">Curriculum Mapping</h2>
    <p>
        Assign curriculum to specific grade levels for this school. This mapping will be used when creating or updating students.
    </p>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1rem; margin-top: 1.5rem;">
        {% for grade in range(3, 13) %}
        <div class="card" style="margin: 0; padding: 1rem;">
            <h3 style="margin-top: 0; color: #2c3e50;">Grade {{ grade }}</h3>
            
            {% set grade_curriculums = curriculums|selectattr('grade', 'eq', grade)|list %}
            {% if grade_curriculums %}
            <ul style="padding-left: 1.5rem; margin: 0.5rem 0;">
                {% for curriculum in grade_curriculums %}
                <li>{{ curriculum.subject }} ({{ curriculum.student_type }})</li>
                {% endfor %}
            </ul>
            {% else %}
            <p style="color: #7f8c8d; font-style: italic;">No curriculum available</p>
            {% endif %}
            
            <a href="{{ url_for('add_curriculum') }}" class="btn-small" style="background: #3498db; margin-top: 0.5rem; display: inline-block;">
                Add for Grade {{ grade }}
            </a>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}